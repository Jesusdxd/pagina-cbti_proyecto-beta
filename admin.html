<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - CBT</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Estilos Globales */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.dark-mode {
            background-color: #121212;
            color: #ffffff;
        }

        /* Header m√°s compacto */
        header {
            background-color: #2E7D32;
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-size: 1.2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideDown 0.5s ease-in-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        header h1 {
            margin: 0;
            font-size: 1.2rem;
        }

        header .header-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        header .logout-button {
            background-color: #d32f2f;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-left: 10px;
        }

        header .logout-button:hover {
            background-color: #c62828;
            transform: scale(1.05);
        }

        header .logout-button:active {
            transform: scale(0.95);
        }

        /* Bot√≥n de modo oscuro con √≠conos */
        .dark-mode-toggle {
            background-color: #333;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark-mode-toggle:hover {
            background-color: #555;
            transform: scale(1.05);
        }

        body.dark-mode .dark-mode-toggle {
            background-color: #4CAF50;
            color: white;
        }

        body.dark-mode .dark-mode-toggle:hover {
            background-color: #45a049;
        }

        /* Input de b√∫squeda */
        #search-input {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.dark-mode #search-input {
            background-color: #333;
            color: white;
        }

        /* Contenedor principal */
        main {
            margin-top: 60px;
            padding: 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Caja de contenido */
        .content-box {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            transition: box-shadow 0.3s ease, transform 0.3s ease, background-color 0.3s ease, color 0.3s ease;
            animation: fadeIn 0.5s ease-in-out;
        }

        body.dark-mode .content-box {
            background-color: #1e1e1e;
            color: #ffffff;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-box:hover {
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
            transform: translateY(-5px);
        }

        .content-box h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #2E7D32;
        }

        body.dark-mode .content-box h2 {
            color: #4CAF50;
        }

        .admin-actions {
            display: flex;
            justify-content: flex-start;
            gap: 15px;
            margin-bottom: 20px;
        }

        .admin-actions button {
            background-color: #2E7D32;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .admin-actions button:hover {
            background-color: #1B5E20;
            transform: scale(1.05);
        }

        /* Listado de Grupos */
        #group-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); /* Ajustar el ancho m√≠nimo */
            gap: 30px; /* Aumentar el espacio entre los grupos */
            margin-top: 20px;
        }

        .group-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease, transform 0.3s ease, background-color 0.3s ease, color 0.3s ease;
            animation: fadeIn 0.5s ease-in-out;
        }

        body.dark-mode .group-container {
            background-color: #1e1e1e;
            color: #ffffff;
        }

        .group-container:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-5px);
        }

        .groups-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
        }

        .groups-table th,
        .groups-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 1rem;
        }

        body.dark-mode .groups-table th,
        body.dark-mode .groups-table td {
            border-bottom: 1px solid #444;
        }

        .groups-table th {
            background-color: #2E7D32;
            color: white;
        }

        body.dark-mode .groups-table th {
            background-color: #4CAF50;
        }

        .groups-table tr:hover {
            background-color: #f4f4f4;
        }

        body.dark-mode .groups-table tr:hover {
            background-color: #333;
        }

        /* Pie de p√°gina */
        footer {
            text-align: center;
            padding: 10px;
            background-color: #2E7D32;
            color: white;
            position: fixed;
            width: 100%;
            bottom: 0;
            font-size: 0.9rem;
            animation: slideUp 0.5s ease-in-out;
        }

        body.dark-mode footer {
            background-color: #1B5E20;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        /* Estilos Responsivos */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 10px;
            }
            .header-buttons {
                flex-direction: column;
                gap: 5px;
            }
            .logout-button {
                margin-left: 0;
            }
            .admin-actions {
                flex-direction: column;
                gap: 10px;
            }
            .content-box {
                padding: 15px;
            }
            .groups-table th, .groups-table td {
                padding: 8px;
                font-size: 0.9rem;
            }
            #group-list {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Menos columnas en pantallas peque√±as */
                gap: 20px; /* Menos espacio en pantallas peque√±as */
            }
        }

        /* Estilos para el dashboard */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-box {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-box h3 {
            margin: 0;
            font-size: 1.5rem;
            color: #2E7D32;
        }

        .stat-box p {
            margin: 0;
            font-size: 1.2rem;
            color: #333;
        }

        body.dark-mode .stat-box {
            background-color: #1e1e1e;
            color: #ffffff;
        }

        body.dark-mode .stat-box h3 {
            color: #4CAF50;
        }

        body.dark-mode .stat-box p {
            color: #ffffff;
        }

        /* Men√∫ Hamburguesa */
        .menu-icon {
            display: none;
            font-size: 24px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .menu-icon {
                display: block;
            }
            .header-buttons {
                display: none;
            }
            .header-buttons.active {
                display: flex;
                flex-direction: column;
                position: absolute;
                top: 60px;
                right: 20px;
                background-color: #2E7D32;
                padding: 10px;
                border-radius: 5px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }
        }
    </style>
</head>
<body onload="cargarAdminDatos()">
    <!-- Barra de encabezado m√°s compacta -->
    <header>
        <h1 id="admin-name">Panel de Administraci√≥n</h1>
        <div class="menu-icon" onclick="toggleMenu()">‚ò∞</div>
        <div class="header-buttons" id="header-buttons">
            <input type="text" id="search-input" placeholder="Buscar alumno..." oninput="buscarAlumno()" aria-label="Buscar alumno">
            <button class="dark-mode-toggle" onclick="toggleDarkMode()" aria-label="Cambiar modo oscuro">üåô</button>
            <button class="logout-button" onclick="logout()" aria-label="Cerrar sesi√≥n">Cerrar Sesi√≥n</button>
        </div>
    </header>

    <!-- Contenido Principal -->
    <main>
        <!-- Dashboard con Resumen General -->
        <section class="content-box">
            <h2>Resumen General</h2>
            <div class="dashboard-stats">
                <div class="stat-box">
                    <h3>Grupos</h3>
                    <p id="total-grupos">0</p>
                </div>
                <div class="stat-box">
                    <h3>Maestros</h3>
                    <p id="total-maestros">0</p>
                </div>
                <div class="stat-box">
                    <h3>Materias</h3>
                    <p id="total-materias">0</p>
                </div>
                <div class="stat-box">
                    <h3>Alumnos</h3>
                    <p id="total-alumnos">0</p>
                </div>
            </div>
            <canvas id="chart-alumnos-por-grupo"></canvas> <!-- Gr√°fico de alumnos por grupo -->
        </section>

        <!-- Gesti√≥n de Grupos y Alumnos -->
        <section class="content-box">
            <h2>Gesti√≥n de Grupos y Alumnos</h2>
            <div class="admin-actions">
                <button onclick="addGroup()" aria-label="Agregar grupo">Agregar Grupo</button>
                <button onclick="removeGroup()" aria-label="Quitar grupo">Quitar Grupo</button>
                <button onclick="exportarDatos()" aria-label="Exportar datos">Exportar Datos</button>
                <button onclick="addTeacher()" aria-label="Agregar maestro">Agregar Maestro</button>
            </div>

            <div id="group-list">
                <!-- Aqu√≠ se insertar√°n din√°micamente los grupos -->
            </div>
        </section>

        <!-- Asignaci√≥n de Maestros a Grupos y Materias -->
        <section class="content-box">
            <h2>Asignaci√≥n de Maestros y Materias</h2>
            <div id="teacher-assignment">
                <!-- Aqu√≠ se insertar√° la tabla de asignaci√≥n de maestros -->
            </div>
        </section>

        <!-- Gesti√≥n de Materias -->
        <section class="content-box">
            <h2>Gesti√≥n de Materias</h2>
            <div class="admin-actions">
                <button onclick="addSubject()" aria-label="Agregar materia">Agregar Materia</button>
                <button onclick="assignSubjectToGroup()" aria-label="Asignar materia a grupo">Asignar Materia a Grupo</button>
            </div>
            <div id="subject-list">
                <!-- Aqu√≠ se insertar√°n din√°micamente las materias -->
            </div>
        </section>

        <!-- Horarios de Clases -->
        <section class="content-box">
            <h2>Horarios de Clases</h2>
            <div id="schedule-list">
                <!-- Aqu√≠ se insertar√°n din√°micamente los horarios -->
            </div>
        </section>

        <!-- Tareas y Actividades -->
        <section class="content-box">
            <h2>Tareas y Actividades</h2>
            <div id="task-list">
                <!-- Aqu√≠ se insertar√°n din√°micamente las tareas -->
            </div>
        </section>

        <!-- Reportes y Estad√≠sticas -->
        <section class="content-box">
            <h2>Reportes y Estad√≠sticas</h2>
            <div id="report-list">
                <!-- Aqu√≠ se insertar√°n din√°micamente los reportes -->
            </div>
        </section>
    </main>

    <!-- Pie de p√°gina -->
    <footer>
        <p>&copy; 2025 CBT Profesor Luis Camarena Gonz√°lez</p>
    </footer>

    <script>
        // Funci√≥n para mostrar notificaciones con SweetAlert2
        function mostrarNotificacion(titulo, mensaje, tipo) {
            Swal.fire({
                title: titulo,
                text: mensaje,
                icon: tipo,
                confirmButtonText: 'OK'
            });
        }

        // Cargar datos del administrador
        function cargarAdminDatos() {
            let urlParams = new URLSearchParams(window.location.search);
            let adminEmail = urlParams.get('admin');
            if (!adminEmail) {
                mostrarNotificacion("Error", "No has iniciado sesi√≥n.", "error");
                window.location.href = "index.html";
                return;
            }
            document.getElementById("admin-name").textContent = `Bienvenido, ${adminEmail}`;
            cargarGrupos();
            cargarMaestros();
            cargarMaterias();
            actualizarResumen();
            cargarGraficoAlumnosPorGrupo();
        }

        // Actualizar el resumen general
        function actualizarResumen() {
            let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
            let maestros = JSON.parse(localStorage.getItem("maestros")) || [];
            let materias = JSON.parse(localStorage.getItem("materias")) || [];
            document.getElementById("total-grupos").textContent = grupos.length;
            document.getElementById("total-maestros").textContent = maestros.length;
            document.getElementById("total-materias").textContent = materias.length;
            let totalAlumnos = grupos.reduce((total, grupo) => total + grupo.alumnos.length, 0);
            document.getElementById("total-alumnos").textContent = totalAlumnos;
        }

        // Cargar gr√°fico de alumnos por grupo
        function cargarGraficoAlumnosPorGrupo() {
            let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
            let ctx = document.getElementById('chart-alumnos-por-grupo').getContext('2d');
            let labels = grupos.map(grupo => grupo.nombre);
            let data = grupos.map(grupo => grupo.alumnos.length);
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Alumnos por Grupo',
                        data: data,
                        backgroundColor: '#2E7D32',
                        borderColor: '#1B5E20',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Cerrar sesi√≥n
        function logout() {
            Swal.fire({
                title: '¬øCerrar sesi√≥n?',
                text: '¬øEst√°s seguro de que deseas cerrar sesi√≥n?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'S√≠, cerrar sesi√≥n',
                cancelButtonText: 'Cancelar',
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = "index.html";
                }
            });
        }

        // Cargar grupos desde localStorage
        function cargarGrupos() {
            let groupContainer = document.getElementById("group-list");
            groupContainer.innerHTML = "";
            let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
            if (grupos.length === 0) {
                groupContainer.innerHTML = "<p>No hay grupos registrados.</p>";
                return;
            }
            grupos.forEach(grupo => {
                let groupElement = document.createElement("div");
                groupElement.classList.add("group-container");
                groupElement.innerHTML = 
                    `<h3>Grupo: ${grupo.nombre}</h3>
                    <table class="groups-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Matr√≠cula</th>
                                <th>Correo</th>
                                <th>Contrase√±a</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="${grupo.id}">
                            ${grupo.alumnos.map(alumno => 
                                `<tr>
                                    <td>${alumno.nombre}</td>
                                    <td>${alumno.matricula}</td>
                                    <td>${alumno.email}</td>
                                    <td>${alumno.password}</td>
                                    <td>
                                        <button onclick="removeStudent('${grupo.id}', '${alumno.matricula}')" aria-label="Quitar alumno">Quitar</button>
                                    </td>
                                </tr>`
                            ).join('')}
                        </tbody>
                    </table>
                    <button onclick="addStudent('${grupo.id}')" aria-label="Agregar alumno">Agregar Alumno</button>
                    <button onclick="assignTeacher('${grupo.id}')" aria-label="Asignar maestro">Asignar Maestro</button>`;
                groupContainer.appendChild(groupElement);
            });
        }

        // Cargar maestros desde localStorage
        function cargarMaestros() {
            let maestros = JSON.parse(localStorage.getItem("maestros")) || [];
            let teacherAssignment = document.getElementById("teacher-assignment");
            teacherAssignment.innerHTML = `
                <table class="groups-table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Correo</th>
                            <th>Contrase√±a</th>
                            <th>Materia</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${maestros.map(maestro => `
                            <tr>
                                <td>${maestro.nombre}</td>
                                <td>${maestro.email}</td>
                                <td>${maestro.password}</td>
                                <td>${maestro.materia || 'No asignada'}</td>
                                <td>
                                    <button onclick="removeTeacher('${maestro.id}')" aria-label="Quitar maestro">Quitar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Cargar materias desde localStorage
        function cargarMaterias() {
            let materias = JSON.parse(localStorage.getItem("materias")) || [];
            let subjectList = document.getElementById("subject-list");
            subjectList.innerHTML = "";

            // Agrupar materias por carrera
            let materiasPorCarrera = {};
            materias.forEach(materia => {
                if (!materiasPorCarrera[materia.carrera]) {
                    materiasPorCarrera[materia.carrera] = [];
                }
                materiasPorCarrera[materia.carrera].push(materia);
            });

            // Mostrar las materias organizadas por carrera
            for (let carrera in materiasPorCarrera) {
                let carreraSection = document.createElement("div");
                carreraSection.innerHTML = `<h3>Carrera: ${carrera}</h3>`;
                let table = document.createElement("table");
                table.classList.add("groups-table");
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${materiasPorCarrera[carrera].map(materia => `
                            <tr>
                                <td>${materia.nombre}</td>
                                <td>
                                    <button onclick="removeSubject('${materia.id}')" aria-label="Quitar materia">Quitar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
                carreraSection.appendChild(table);
                subjectList.appendChild(carreraSection);
            }
        }

        // Agregar un grupo
        function addGroup() {
            Swal.fire({
                title: 'Agregar Grupo',
                html: `
                    <input type="text" id="group-name" class="swal2-input" placeholder="Nombre del Grupo">
                    <select id="group-carrera" class="swal2-input">
                        <option value="Inform√°tica">Inform√°tica</option>
                        <option value="Administraci√≥n">Administraci√≥n</option>
                        <option value="Contabilidad">Contabilidad</option>
                        <option value="Electr√≥nica">Electr√≥nica</option>
                    </select>
                    <select id="group-grado" class="swal2-input">
                        <option value="1">1¬∞</option>
                        <option value="2">2¬∞</option>
                        <option value="3">3¬∞</option>
                        <option value="4">4¬∞</option>
                        <option value="5">5¬∞</option>
                        <option value="6">6¬∞</option>
                    </select>
                    <input type="text" id="group-grupo" class="swal2-input" placeholder="Grupo (Ej: A, B, C)">
                `,
                showCancelButton: true,
                confirmButtonText: 'Agregar',
                cancelButtonText: 'Cancelar',
                preConfirm: () => {
                    let nombreGrupo = document.getElementById('group-name').value;
                    let carrera = document.getElementById('group-carrera').value;
                    let grado = document.getElementById('group-grado').value;
                    let grupo = document.getElementById('group-grupo').value;
                    if (!nombreGrupo || !carrera || !grado || !grupo) {
                        Swal.showValidationMessage('Todos los campos son obligatorios.');
                    }
                    return { nombreGrupo, carrera, grado, grupo };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    let { nombreGrupo, carrera, grado, grupo } = result.value;
                    let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
                    let grupoExistente = grupos.find(g => g.nombre === nombreGrupo);
                    if (grupoExistente) {
                        mostrarNotificacion("Error", "El grupo ya existe.", "error");
                        return;
                    }
                    let nuevoGrupo = { 
                        id: `grupo-${Date.now()}`, 
                        nombre: nombreGrupo, 
                        carrera: carrera, 
                        grado: grado, 
                        grupo: grupo, 
                        alumnos: [], 
                        maestro: null 
                    };
                    grupos.push(nuevoGrupo);
                    localStorage.setItem("grupos", JSON.stringify(grupos));
                    cargarGrupos();
                    mostrarNotificacion("√âxito", "Grupo agregado correctamente.", "success");
                }
            });
        }

        // Eliminar un grupo
        function removeGroup() {
            Swal.fire({
                title: 'Eliminar Grupo',
                input: 'text',
                inputLabel: 'Nombre del Grupo',
                inputPlaceholder: 'Ingrese el nombre del grupo a eliminar',
                showCancelButton: true,
                confirmButtonText: 'Eliminar',
                cancelButtonText: 'Cancelar',
                inputValidator: (value) => {
                    if (!value) {
                        return 'El nombre del grupo no puede estar vac√≠o.';
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    let nombreGrupo = result.value;
                    Swal.fire({
                        title: '¬øEst√°s seguro?',
                        text: "¬°No podr√°s revertir esto!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#2E7D32',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'S√≠, eliminar'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
                            grupos = grupos.filter(g => g.nombre !== nombreGrupo);
                            localStorage.setItem("grupos", JSON.stringify(grupos));
                            cargarGrupos();
                            mostrarNotificacion("√âxito", "Grupo eliminado correctamente.", "success");
                        }
                    });
                }
            });
        }

        // Agregar un alumno
        function addStudent(groupId) {
            Swal.fire({
                title: 'Agregar Alumno',
                html: `
                    <input type="text" id="student-name" class="swal2-input" placeholder="Nombre del Alumno">
                    <input type="text" id="student-id" class="swal2-input" placeholder="Matr√≠cula del Alumno">
                `,
                showCancelButton: true,
                confirmButtonText: 'Agregar',
                cancelButtonText: 'Cancelar',
                preConfirm: () => {
                    let studentName = document.getElementById('student-name').value;
                    let studentId = document.getElementById('student-id').value;
                    if (!studentName || !studentId) {
                        Swal.showValidationMessage('Todos los campos son obligatorios.');
                    }
                    return { studentName, studentId };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    let { studentName, studentId } = result.value;
                    let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
                    let grupo = grupos.find(g => g.id === groupId);
                    if (grupo) {
                        let alumnoExistente = grupo.alumnos.find(a => a.matricula === studentId);
                        if (alumnoExistente) {
                            mostrarNotificacion("Error", "El alumno ya est√° registrado.", "error");
                            return;
                        }
                        // Generar correo y contrase√±a autom√°ticamente
                        let studentEmail = `al${studentId}@cbt.com`;
                        let studentPassword = generarContrase√±a();
                        grupo.alumnos.push({ 
                            nombre: studentName, 
                            matricula: studentId, 
                            email: studentEmail, 
                            password: studentPassword 
                        });
                        // Ordenar alumnos por nombre
                        grupo.alumnos.sort((a, b) => a.nombre.localeCompare(b.nombre));
                        localStorage.setItem("grupos", JSON.stringify(grupos));
                        cargarGrupos();
                        mostrarNotificacion("√âxito", "Alumno agregado correctamente.", "success");
                    }
                }
            });
        }

        // Eliminar un alumno
        function removeStudent(groupId, studentId) {
            Swal.fire({
                title: '¬øEst√°s seguro?',
                text: "¬°No podr√°s revertir esto!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#2E7D32',
                cancelButtonColor: '#d33',
                confirmButtonText: 'S√≠, eliminar'
            }).then((result) => {
                if (result.isConfirmed) {
                    let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
                    let grupo = grupos.find(g => g.id === groupId);
                    if (grupo) {
                        grupo.alumnos = grupo.alumnos.filter(alumno => alumno.matricula !== studentId);
                        localStorage.setItem("grupos", JSON.stringify(grupos));
                        cargarGrupos();
                        mostrarNotificacion("√âxito", "Alumno eliminado correctamente.", "success");
                    }
                }
            });
        }

        // Agregar un maestro
        function addTeacher() {
            Swal.fire({
                title: 'Agregar Maestro',
                html: `
                    <input type="text" id="teacher-name" class="swal2-input" placeholder="Nombre del Maestro">
                    <input type="text" id="teacher-subject" class="swal2-input" placeholder="Materia que imparte">
                `,
                showCancelButton: true,
                confirmButtonText: 'Agregar',
                cancelButtonText: 'Cancelar',
                preConfirm: () => {
                    let teacherName = document.getElementById('teacher-name').value;
                    let teacherSubject = document.getElementById('teacher-subject').value;
                    if (!teacherName || !teacherSubject) {
                        Swal.showValidationMessage('Todos los campos son obligatorios.');
                    }
                    return { teacherName, teacherSubject };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    let { teacherName, teacherSubject } = result.value;
                    let maestros = JSON.parse(localStorage.getItem("maestros")) || [];
                    // Generar correo y contrase√±a autom√°ticamente
                    let teacherEmail = `prof.${teacherName.toLowerCase().replace(/\s+/g, '.')}@cbt.com`;
                    let teacherPassword = generarContrase√±a();
                    let nuevoMaestro = { 
                        id: `maestro-${Date.now()}`, 
                        nombre: teacherName, 
                        email: teacherEmail, 
                        password: teacherPassword,
                        materia: teacherSubject 
                    };
                    maestros.push(nuevoMaestro);
                    localStorage.setItem("maestros", JSON.stringify(maestros));
                    cargarMaestros();
                    mostrarNotificacion("√âxito", "Maestro agregado correctamente.", "success");
                }
            });
        }

        // Generar contrase√±a autom√°ticamente (solo letras y n√∫meros)
        function generarContrase√±a() {
            const caracteres = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; // Solo letras y n√∫meros
            let contrase√±a = '';
            for (let i = 0; i < 10; i++) { // Longitud de 10 caracteres
                contrase√±a += caracteres.charAt(Math.floor(Math.random() * caracteres.length));
            }
            return contrase√±a;
        }

        // Asignar un maestro a un grupo
        function assignTeacher(groupId) {
            let maestros = JSON.parse(localStorage.getItem("maestros")) || [];
            if (maestros.length === 0) {
                mostrarNotificacion("Error", "No hay maestros disponibles.", "error");
                return;
            }

            let options = maestros.map(maestro => `<option value="${maestro.id}">${maestro.nombre}</option>`).join('');
            Swal.fire({
                title: 'Asignar Maestro',
                html: `<select id="teacher-select">${options}</select>`,
                showCancelButton: true,
                confirmButtonText: 'Asignar',
                cancelButtonText: 'Cancelar',
                preConfirm: () => {
                    let selectedTeacherId = document.getElementById('teacher-select').value;
                    return selectedTeacherId;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
                    let grupo = grupos.find(g => g.id === groupId);
                    if (grupo) {
                        grupo.maestro = result.value;
                        localStorage.setItem("grupos", JSON.stringify(grupos));
                        cargarGrupos();
                        mostrarNotificacion("√âxito", "Maestro asignado correctamente.", "success");
                    }
                }
            });
        }

        // Agregar una materia
        function addSubject() {
            Swal.fire({
                title: 'Agregar Materia',
                html: `
                    <input type="text" id="subject-name" class="swal2-input" placeholder="Nombre de la Materia">
                    <select id="subject-carrera" class="swal2-input">
                        <option value="Inform√°tica">Inform√°tica</option>
                        <option value="Administraci√≥n">Administraci√≥n</option>
                        <option value="Contabilidad">Contabilidad</option>
                        <option value="Electr√≥nica">Electr√≥nica</option>
                    </select>
                `,
                showCancelButton: true,
                confirmButtonText: 'Agregar',
                cancelButtonText: 'Cancelar',
                preConfirm: () => {
                    let subjectName = document.getElementById('subject-name').value;
                    let subjectCarrera = document.getElementById('subject-carrera').value;
                    if (!subjectName || !subjectCarrera) {
                        Swal.showValidationMessage('Todos los campos son obligatorios.');
                    }
                    return { subjectName, subjectCarrera };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    let { subjectName, subjectCarrera } = result.value;
                    let materias = JSON.parse(localStorage.getItem("materias")) || [];
                    let materiaExistente = materias.find(m => m.nombre === subjectName && m.carrera === subjectCarrera);
                    if (materiaExistente) {
                        mostrarNotificacion("Error", "La materia ya existe en esta carrera.", "error");
                        return;
                    }
                    let nuevaMateria = { 
                        id: `materia-${Date.now()}`, 
                        nombre: subjectName,
                        carrera: subjectCarrera 
                    };
                    materias.push(nuevaMateria);
                    localStorage.setItem("materias", JSON.stringify(materias));
                    cargarMaterias();
                    mostrarNotificacion("√âxito", "Materia agregada correctamente.", "success");
                }
            });
        }

        // Asignar materia a un grupo
        function assignSubjectToGroup() {
            let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
            let materias = JSON.parse(localStorage.getItem("materias")) || [];
            if (grupos.length === 0 || materias.length === 0) {
                mostrarNotificacion("Error", "No hay grupos o materias disponibles.", "error");
                return;
            }

            let groupOptions = grupos.map(grupo => `<option value="${grupo.id}">${grupo.nombre} (${grupo.carrera})</option>`).join('');
            Swal.fire({
                title: 'Asignar Materia a Grupo',
                html: `
                    <select id="group-select" onchange="filtrarMateriasPorCarrera()">${groupOptions}</select>
                    <select id="subject-select"></select>
                `,
                showCancelButton: true,
                confirmButtonText: 'Asignar',
                cancelButtonText: 'Cancelar',
                didOpen: () => {
                    // Filtrar materias por la carrera del primer grupo seleccionado por defecto
                    filtrarMateriasPorCarrera();
                },
                preConfirm: () => {
                    let selectedGroupId = document.getElementById('group-select').value;
                    let selectedSubjectId = document.getElementById('subject-select').value;
                    return { selectedGroupId, selectedSubjectId };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    let { selectedGroupId, selectedSubjectId } = result.value;
                    let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
                    let grupo = grupos.find(g => g.id === selectedGroupId);
                    if (grupo) {
                        grupo.materias = grupo.materias || [];
                        grupo.materias.push(selectedSubjectId);
                        localStorage.setItem("grupos", JSON.stringify(grupos));
                        cargarGrupos();
                        mostrarNotificacion("√âxito", "Materia asignada correctamente.", "success");
                    }
                }
            });
        }

        // Funci√≥n para filtrar materias por la carrera del grupo seleccionado
        function filtrarMateriasPorCarrera() {
            let grupoId = document.getElementById('group-select').value;
            let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
            let grupo = grupos.find(g => g.id === grupoId);
            let materias = JSON.parse(localStorage.getItem("materias")) || [];

            // Filtrar materias por la carrera del grupo seleccionado
            let materiasFiltradas = materias.filter(materia => materia.carrera === grupo.carrera);
            let subjectOptions = materiasFiltradas.map(materia => `<option value="${materia.id}">${materia.nombre}</option>`).join('');
            document.getElementById('subject-select').innerHTML = subjectOptions;
        }

        // Eliminar una materia
        function removeSubject(subjectId) {
            Swal.fire({
                title: '¬øEst√°s seguro?',
                text: "¬°No podr√°s revertir esto!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#2E7D32',
                cancelButtonColor: '#d33',
                confirmButtonText: 'S√≠, eliminar'
            }).then((result) => {
                if (result.isConfirmed) {
                    let materias = JSON.parse(localStorage.getItem("materias")) || [];
                    materias = materias.filter(m => m.id !== subjectId);
                    localStorage.setItem("materias", JSON.stringify(materias));
                    cargarMaterias();
                    mostrarNotificacion("√âxito", "Materia eliminada correctamente.", "success");
                }
            });
        }

        // B√∫squeda de alumnos con debounce
        let timeout;
        function buscarAlumno() {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                let searchTerm = document.getElementById('search-input').value.toLowerCase();
                let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
                let resultados = [];
                grupos.forEach(grupo => {
                    grupo.alumnos.forEach(alumno => {
                        if (alumno.nombre.toLowerCase().includes(searchTerm) || alumno.matricula.toLowerCase().includes(searchTerm)) {
                            resultados.push({ grupo: grupo.nombre, alumno });
                        }
                    });
                });
                mostrarResultados(resultados);
            }, 300); // Debounce de 300ms
        }

        // Mostrar resultados de b√∫squeda
        function mostrarResultados(resultados) {
            let groupContainer = document.getElementById("group-list");
            groupContainer.innerHTML = "";

            if (resultados.length === 0) {
                groupContainer.innerHTML = "<p>No se encontraron resultados.</p>";
                return;
            }

            resultados.forEach(resultado => {
                let groupElement = document.createElement("div");
                groupElement.classList.add("group-container");
                groupElement.innerHTML = 
                    `<h3>Grupo: ${resultado.grupo}</h3>
                    <table class="groups-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Matr√≠cula</th>
                                <th>Correo</th>
                                <th>Contrase√±a</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>${resultado.alumno.nombre}</td>
                                <td>${resultado.alumno.matricula}</td>
                                <td>${resultado.alumno.email}</td>
                                <td>${resultado.alumno.password}</td>
                                <td>
                                    <button onclick="removeStudent('${resultado.grupo}', '${resultado.alumno.matricula}')">Quitar</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>`;
                groupContainer.appendChild(groupElement);
            });
        }

        // Exportar datos a Excel
        function exportarDatos() {
            let grupos = JSON.parse(localStorage.getItem("grupos")) || [];
            let maestros = JSON.parse(localStorage.getItem("maestros")) || [];

            // Crear un libro de trabajo y una hoja
            let workbook = XLSX.utils.book_new();
            let worksheetData = [];

            // Encabezados
            worksheetData.push(["Grupo", "Nombre", "Matr√≠cula", "Correo", "Contrase√±a", "Maestro"]);

            // Datos
            grupos.forEach(grupo => {
                let maestroNombre = "No asignado";
                if (grupo.maestro) {
                    let maestro = maestros.find(m => m.id === grupo.maestro);
                    if (maestro) maestroNombre = maestro.nombre;
                }
                grupo.alumnos.forEach(alumno => {
                    worksheetData.push([
                        grupo.nombre,
                        alumno.nombre,
                        alumno.matricula,
                        alumno.email,
                        alumno.password,
                        maestroNombre
                    ]);
                });
            });

            // Convertir los datos en una hoja de trabajo
            let worksheet = XLSX.utils.aoa_to_sheet(worksheetData);
            XLSX.utils.book_append_sheet(workbook, worksheet, "Alumnos");

            // Generar el archivo Excel
            XLSX.writeFile(workbook, "alumnos.xlsx");
        }

        // Cambiar modo oscuro
        function toggleDarkMode() {
            const body = document.body;
            const darkModeToggle = document.querySelector('.dark-mode-toggle');
            body.classList.toggle('dark-mode');
            const isDarkMode = body.classList.contains('dark-mode');
            localStorage.setItem('dark-mode', isDarkMode);

            // Cambiar el √≠cono del bot√≥n seg√∫n el modo actual
            if (isDarkMode) {
                darkModeToggle.textContent = 'üåû';
            } else {
                darkModeToggle.textContent = 'üåô';
            }
        }

        // Verificar el modo oscuro al cargar la p√°gina
        window.onload = function() {
            const body = document.body;
            const darkModeToggle = document.querySelector('.dark-mode-toggle');
            const isDarkMode = localStorage.getItem('dark-mode') === 'true';

            if (isDarkMode) {
                body.classList.add('dark-mode');
                darkModeToggle.textContent = 'üåû';
            } else {
                darkModeToggle.textContent = 'üåô';
            }

            cargarAdminDatos();
        };

        // Funci√≥n para mostrar/ocultar el men√∫ hamburguesa
        function toggleMenu() {
            const headerButtons = document.getElementById('header-buttons');
            headerButtons.classList.toggle('active');
        }
    </script>
</body>
</html>